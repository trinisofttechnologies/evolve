<<<<<<< HEAD
TedLeader = new Meteor.Collection("tedleader");
TedFellows = new Meteor.Collection("tedfellows");
=======
TedSpeakers = new Meteor.Collection("tedspeakers");

>>>>>>> be12e7d90b4116f710f93a89187eac9ff83aebc4
if (Meteor.isClient) {
  Template.hello.greeting = function () {
    return "Welcome to hello.";
  };

  Template.hello.events({
    'click input': function () {
      // template data, if any, is available in 'this'
      if (typeof console !== 'undefined')
        console.log("You pressed the button");
    }
  });
}

if (Meteor.isServer) {
    Meteor.startup(function () {
        scrapTedFollows();
    });

    var result,moreResult;

    
    // scrapTed();
    getMoreDetails();


}

<<<<<<< HEAD
function scrapTedFollows(){
    var i=1;
    var $ = null;
    while(true){
        break;
        var url = "http://www.ted.com/people/fellows?page= " +i +"&per_page=30";
        var result = Meteor.http.get(url);
        $ = cheerio.load(result.content);
        var fellows = $(".results .col");
        console.log(fellows.length);
        var currentFellows = null;
        var cursorTedFellows = null;
        for(var j=0,jl=fellows.length;j<jl;j++){
            currentFellows = fellows[j];
            var currentJSON = {
                "expert" : $(currentFellows).find(".p4").text(),
                "name" : $(currentFellows).find(".m5").text(),
                "imgurl" : $(currentFellows).find("img").attr("src"),
                "link" : "http://www.ted.com" +$(currentFellows).find("a").attr("href"),
            }
            cursorTedFellows = TedFellows.findOne(currentJSON);
            if(cursorTedFellows){
                console.log("updated");
            }
            else{
                console.log("inserted");
                TedFellows.insert(currentJSON);                
            }
            console.log(currentJSON);
        }
        i++;

        if(i>1)
            break;        
        
    }
    scrapTedFollowsSecondPage();
}

function scrapTedFollowsSecondPage(){
    var link = []
    TedFellows.find({}).forEach(function(data){
        // console.log(data.link);
        link.push(data.link);
    });
    var url = null;
    var result = null;
    var moreDetails = null;
    var referenceLink = [];
    var links = null;
    for(var i=0,il=link.length;i<1;i++){
        url = link[i];
        result = Meteor.http.get(url);
        $ = cheerio.load(result.content);
        links = $(".profile-header__links__inner");
        var website = [];
        console.log(links.length)
        for(var j=0,jl=links.length;j<jl;j++){
            // $(links
            // website.push()
        }
    }
}
=======
function scrapTed(){
      var $ = null,result = null;
      var url = "http://www.ted.com/speakers";
      result = Meteor.http.get(url);
      $ = cheerio.load(result.content);
      var designation = $(".col");
      var currentDiv = null;
      //currentDiv = cheerio.load(designation[0])
      // console.log(currentDiv);
      // console.log(designation.length)
      //var divProd = $('div.prod');
      var myArray = [];
      var currentJson = {};
      var moredetails,imgurl,name,expert;
      for(var i=0,il=designation.length;i<il;i++){
          currentDiv = designation[i];
          //console.log(designation[i].children[0].data)
          // currentJson = {
          //         moredetails :  "http://www.ted.com"+$(currentDiv).find('a').attr('href'),
          //         imgurl : $(currentDiv).find('.thumb__tugger img').attr('src'),
          //         name : $(currentDiv).find('.media__message h4').text(),
          //         expert : $(currentDiv).find('.media__message .p4').text()
          //     };
          // myArray.push(currentJson);
          moredetails = "http://www.ted.com"+$(currentDiv).find('a').attr('href');
          imgurl = $(currentDiv).find('.thumb__tugger img').attr('src');
          name = $(currentDiv).find('.media__message h4').text();
          expert = $(currentDiv).find('.media__message .p4').text();
          var currentcursor= TedSpeakers.findOne({"moredetails":moredetails});
          if(currentcursor){
            TedSpeakers.update({"moredetails":moredetails},{$set : {"imgurl":imgurl,"name":name,"expert":expert}});
          }else{
            var Follow = {"moredetails": moredetails,"imgurl":imgurl,"name": name,"expert": expert};
            TedSpeakers.insert(Follow);
          }
      }
      //console.log(moredetails);
    }
    function getMoreDetails(){
      var $ = null,moreResult = null;
      var link1,link2,link3,profileintro,listen,say
      var activeurl = [];
      //console.log("first")
      TedSpeakers.find({}).forEach(function(data){
          activeurl.push(data.moredetails);
      });
      for(var i=0,il=activeurl.length-1;i<il;i++){
          var url = activeurl[i];
          if(url && (!url.match("undefined"))&&url.length>27){
            moreResult = Meteor.http.get(url);
            $ = cheerio.load(moreResult.content);

            var a = $('.profile-header__links__inner a');
            for(var j=0,jl=a.length;j<jl;j++){
                //console.log($(a[j]).attr('href'));
                link1 = $(a[0]).attr('href');
                link2 = $(a[1]).attr('href');
                link3 = $(a[2]).attr('href');
            }
            profileintro =$('.profile-intro').text();
            //listen = $('.section section--minor p');
            // for(var k=0,kl=listen.length;k<kl;k++){
            //     console.log($(listen[k]).text());
            // }
            say =$('bloquote p').text();
          }
          

      }
    }
>>>>>>> be12e7d90b4116f710f93a89187eac9ff83aebc4
