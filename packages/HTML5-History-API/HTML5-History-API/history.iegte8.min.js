/*
 * History API JavaScript Library v4.0.0
 *
 * Support: IE8+, FF3+, Opera 9+, Safari, Chrome and other
 *
 * Copyright 2011-2013, Dmitrii Pakhtinov ( spb.piksel@gmail.com )
 *
 * http://spb-piksel.ru/
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Update: 19.05.13 22:46
 */
(function(e){var g=!0,i=null,n=!1;function C(){}function h(a,b,c){if(a&&!b)var b=h(),c=b.d,j=b.h,a=/^(?:[\w0-9]+\:)?\/\//.test(a)?0===a.indexOf("/")?j+a:a:j+"//"+b.g+(0===a.indexOf("/")?a:0===a.indexOf("?")?c+a:0===a.indexOf("#")?c+b.e+a:c.replace(/[^\/]+$/g,"")+a);else if(a=b?a:d.href,!p||c)a=a.replace(/^[^#]*/,"")||"#",a=d.protocol+"//"+d.host+m.basepath+a.replace(RegExp("^#[/]?(?:"+m.type+")?"),"");H.href=a;var a=/(?:([\w0-9]+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/.exec(H.href),b=
a[2]+(a[3]?":"+a[3]:""),c=a[4]||"/",j=a[5]||"",e="#"===a[6]?"":a[6]||"",I=c+j+e,f=c.replace(RegExp("^"+m.basepath,"i"),m.type)+j;return{b:a[1]+"//"+b+I,h:a[1],g:b,i:a[2],k:a[3]||"",d:c,e:j,a:e,c:I,j:f,f:f+e}}function W(a){var b="";if(w)b+=w.getItem(x);else{var c=f.cookie.split(x+"=");1<c.length&&(b+=c.pop().split(";").shift()||"null")}try{q=a.parse(b)||{}}catch(e){q={}}k(o+"unload",function(){if(w)w.setItem(x,a.stringify(q));else{var b={};if(b[d.href]=l.state)f.cookie=x+"="+a.stringify(b)}},n)}function y(a,
b,c,j){var c=c||{set:C},d=!c.set,f=!c.get,h={configurable:g,set:function(){d=1},get:function(){f=1}};try{u(a,b,h),a[b]=a[b],u(a,b,c)}catch(m){}if(!d||!f)if(a.__defineGetter__&&(a.__defineGetter__(b,h.get),a.__defineSetter__(b,h.set),a[b]=a[b],c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)),(!d||!f)&&a===e){try{var l=a[b];a[b]=i}catch(p){}if("execScript"in e)e.execScript("Public "+b,"VBScript");else try{u(a,b,{value:C})}catch(q){}a[b]=l}else if(!d||!f)try{try{var k=D.create(a);
u(D.getPrototypeOf(k)===a?k:a,b,c);for(var o in a)"function"===typeof a[o]&&(k[o]=a[o].bind(a));try{j.call(k,k,a)}catch(r){}a=k}catch(s){u(a.constructor.prototype,b,c)}}catch(t){return n}return a}function X(a,b,c){c=c||{};a=a===J?d:a;c.set=c.set||function(c){a[b]=c};c.get=c.get||function(){return a[b]};return c}function z(a,b){var c=(""+("string"===typeof a?a:a.type)).replace(/^on/,""),j=r[c];if(j){b="string"===typeof a?b:a;if(b.target==i)for(var d=["target","currentTarget","srcElement","type"];a=
d.pop();)b=y(b,a,{get:"type"===a?function(){return c}:function(){return e}});(("popstate"===c?e.onpopstate:e.onhashchange)||C).call(e,b);for(var d=0,f=j.length;d<f;d++)j[d].call(e,b);return g}return Y(a,b)}function K(){var a=f.createEvent?f.createEvent("Event"):f.createEventObject();a.initEvent?a.initEvent("popstate",n,n):a.type="popstate";a.state=l.state;z(a)}function t(a,b,c,e){p||(b=h(b),b.c!==h().c&&(v=e,c?d.replace("#"+b.f):d.hash=b.f));!A&&a&&(q[d.href]=a);B=n}function L(a){if(v){M!==d.href&&
K();var a=a||e.event,b=h(v,g),c=h();a.oldURL||(a.oldURL=b.b,a.newURL=c.b);b.a!==c.a&&z(a)}v=d.href}function N(a){setTimeout(function(){k("popstate",function(a){M=d.href;A||(a=y(a,"state",{get:function(){return l.state}}));z(a)},n)},0);!p&&a!==g&&l.location&&(O(l.location.hash),B&&(B=n,K()))}function Z(a){var a=a||e.event,b=a.target||a.srcElement,c="defaultPrevented"in a?a.defaultPrevented:a.returnValue===n;b&&"A"===b.nodeName&&!c&&(c=h(),b=h(b.getAttribute("href",2)),c.b.split("#").shift()===b.b.split("#").shift()&&
(c.a!==b.a&&(l.location.hash=b.a),O(b.a),a.preventDefault?a.preventDefault():a.returnValue=n))}function O(a){var b=f.getElementById(a=(a||"").replace(/^#/,""));b&&b.id===a&&"A"===b.nodeName&&(a=b.getBoundingClientRect(),e.scrollTo(E.scrollLeft||0,a.top+(E.scrollTop||0)-(E.clientTop||0)))}var f=e.document,E=f.documentElement,w=e.sessionStorage,D=e.Object,P=e.JSON,d=e.location,s=e.history,l=s,F=s.pushState,Q=s.replaceState,p=!!F,A="state"in s,u=D.defineProperty,R=y({},"t")?{}:f.createElement("a"),o=
"",G=e.addEventListener?"addEventListener":(o="on")&&"attachEvent",S=e.removeEventListener?"removeEventListener":"detachEvent",T=e.dispatchEvent?"dispatchEvent":"fireEvent",k=e[G],U=e[S],Y=e[T],m={basepath:"/",redirect:0,type:"/"},x="__historyAPI__",H=f.createElement("a"),v=d.href,M="",B=n,q={},r={},$={onhashchange:i,onpopstate:i},V={redirect:function(a,b){m.basepath=b=b==i?m.basepath:b;m.type=a=a==i?m.type:a;if(e.top==e.self){var c=h(i,n,g).c,j=d.search,f=d.pathname;p?(c!=b&&RegExp("^"+b+"$","i").test(f)&&
d.replace(c),RegExp("^"+b+"$","i").test(f+"/")?d.replace(b):RegExp("^"+b,"i").test(f)||d.replace(f.replace(/^\//,b)+j)):f!=b&&d.replace(b+"#"+f.replace(RegExp("^"+b,"i"),a)+j+d.hash)}},pushState:function(a,b,c){F&&F.apply(s,arguments);t(a,c)},replaceState:function(a,b,c){delete q[d.href];Q&&Q.apply(s,arguments);t(a,c,g)},location:{set:function(a){e.location=a},get:function(){return p?d:R}},state:{get:function(){return q[d.href]||i}}},J={assign:function(a){0===(""+a).indexOf("#")?t(i,a):d.assign(a)},
reload:function(){d.reload()},replace:function(a){0===(""+a).indexOf("#")?t(i,a,g):d.replace(a)},toString:function(){return this.href},href:{get:function(){return h().b}},protocol:i,host:i,hostname:i,port:i,pathname:{get:function(){return h().d}},search:{get:function(){return h().e}},hash:{set:function(a){t(i,(""+a).replace(/^(#|)/,"#"),n,v)},get:function(){return h().a}}};(function(){var a=f.getElementsByTagName("script"),a=(a[a.length-1]||{}).src||"";(-1!==a.indexOf("?")?a.split("?").pop():"").replace(/(\w+)(?:=([^&]*))?/g,
function(a,b,c){m[b]=(c||("basepath"===b?"/":"")).replace(/^(0|false)$/,"")});k(o+"hashchange",L,n);var b=[J,R,$,e,V,l];A&&delete V.state;for(var c=0;c<b.length;c+=2)for(var d in b[c])if(b[c].hasOwnProperty(d))if("function"===typeof b[c][d])b[c+1][d]=b[c][d];else{a=X(b[c],d,b[c][d]);if(!y(b[c+1],d,a,function(a,d){if(d===l)e.history=l=b[c+1]=a}))return U(o+"hashchange",L,n),n;b[c+1]===e&&(r[d]=r[d.substr(2)]=[])}m.redirect&&l.redirect();!A&&P&&W(P);if(!p)f[G](o+"click",Z,n);"complete"===f.readyState?
N(g):(!p&&h().c!==m.basepath&&(B=g),k(o+"load",N,n));return g})()&&(l.emulate=!p,e[G]=function(a,b,c){a in r?r[a].push(b):3<arguments.length?k(a,b,c,arguments[3]):k(a,b,c)},e[S]=function(a,b,c){var d=r[a];if(d)for(a=d.length;--a;){if(d[a]===b){d.splice(a,1);break}}else U(a,b,c)},e[T]=z)})(window);
